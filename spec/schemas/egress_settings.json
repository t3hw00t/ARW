{
  "$id": "https://arw/spec/schemas/egress_settings.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "ARW Egress Settings",
  "description": "Runtime egress posture and gateway toggles exposed via the Settings control plane.",
  "type": "object",
  "properties": {
    "posture": { "type": "string", "enum": ["off","public","allowlist","custom","relaxed","standard","strict"] },
    "allowlist": { "type": "array", "items": { "type": "string" } },
    "block_ip_literals": { "type": "boolean" },
    "dns_guard_enable": { "type": "boolean" },
    "proxy_enable": { "type": "boolean" },
    "proxy_port": { "type": "integer", "minimum": 1, "maximum": 65535 },
    "ledger_enable": { "type": "boolean" },
    "scopes": {
      "type": "array",
      "description": "Structured network scopes with optional TTL and protocol/port guards.",
      "items": { "$ref": "#/$defs/networkScope" }
    },
    "multi_label_suffixes": {
      "type": "array",
      "items": { "type": "string", "minLength": 3 },
      "description": "Additional multi-label suffixes (effective TLDs) treated as registrable domains when applying posture/leases."
    }
  },
  "additionalProperties": false,
  "examples": [
    {
      "posture": "standard",
      "allowlist": ["api.github.com","*.githubusercontent.com"],
      "block_ip_literals": true,
      "dns_guard_enable": true,
      "proxy_enable": true,
      "proxy_port": 9080,
      "ledger_enable": true,
      "multi_label_suffixes": ["internal.test","gov.bc.ca"]
    }
  ],
  "$defs": {
    "networkScope": {
      "type": "object",
      "description": "Declarative network scope that augments posture allowlists with optional TTL and capability alignment.",
      "properties": {
        "id": { "type": "string", "minLength": 1 },
        "description": { "type": "string" },
        "hosts": {
          "type": "array",
          "items": { "$ref": "#/$defs/hostPattern" },
          "minItems": 1
        },
        "cidrs": {
          "type": "array",
          "items": { "type": "string", "pattern": "^([0-9]{1,3}(\\.[0-9]{1,3}){3}/[0-9]{1,2}|[0-9a-fA-F:]+/[0-9]{1,3})$" },
          "description": "Optional IPv4/IPv6 CIDR ranges allowed by the scope."
        },
        "ports": {
          "type": "array",
          "items": { "type": "integer", "minimum": 1, "maximum": 65535 },
          "minItems": 1
        },
        "protocols": {
          "type": "array",
          "items": { "type": "string", "enum": ["http", "https", "tcp"] },
          "minItems": 1
        },
        "lease_capabilities": {
          "type": "array",
          "items": { "type": "string", "minLength": 1 },
          "description": "Optional capability strings to mint/refresh as leases when this scope allows traffic."
        },
        "expires_at": {
          "type": "string",
          "format": "date-time",
          "description": "Optional ISO 8601 timestamp; expired scopes are ignored without removing configuration."
        }
      },
      "additionalProperties": false,
      "allOf": [
        { "anyOf": [ { "required": ["hosts"] }, { "required": ["cidrs"] } ] }
      ]
    },
    "hostPattern": {
      "type": "string",
      "minLength": 1,
      "description": "Exact host, wildcard prefix (e.g. *.example.com), or literal IP address."
    }
  }
}
