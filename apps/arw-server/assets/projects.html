<!doctype html><meta charset="utf-8"><title>ARW Projects</title>
<link rel="stylesheet" href="/admin/ui/assets/tokens.css"/>
<link rel="stylesheet" href="/admin/ui/assets/ui-kit.css"/>
<style>
  :root{--color-line:#e5e7eb;--color-ink:#111827;--color-muted:#6b7280;--surface:#ffffff;--surface-muted:#f7f7f9;--noise:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='140' height='140' viewBox='0 0 140 140'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='2' stitchTiles='stitch'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3CfeComponentTransfer%3E%3CfeFuncA type='table' tableValues='0 0.04'/%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E")}
  body{font-family:system-ui,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;margin:20px;color:var(--color-ink);background: var(--surface)}
  .grid{display:grid;grid-template-columns:260px 1fr;gap:16px}
  .row{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
  ul{list-style:none;padding:0;margin:0}
  li{padding:4px 6px;cursor:pointer;border-radius:6px}
  li:hover{background:#f3f4f6}
  pre,textarea{background:linear-gradient(180deg,#ffffff,#fafafa);border:1px solid var(--color-line);border-radius:12px;padding:8px;overflow:auto;box-shadow:inset 0 1px 0 rgba(255,255,255,0.6)}
  textarea{width:100%;min-height:180px}
  @media (prefers-color-scheme: dark){
    :root{ --color-ink:#e5e7eb; --color-line:#1f232a }
    body{ background: var(--surface); color:var(--color-ink) }
    pre,textarea{ background: linear-gradient(180deg,#12161f,#0f141a); border-color:var(--color-line); box-shadow: inset 0 1px 0 rgba(255,255,255,0.06) }
  }
</style>
<h1>Projects</h1>
<div class='row'>
  <span class='badge' id='sseBadge' style='margin-left:auto'><span class='dot'></span> SSE: off</span>
  <span id='statusBadges' style='margin-left:8px'></span>
</div>
<div class='grid'>
  <div class='card'>
    <div class='row' role='toolbar' aria-label='Admin token'>
      <input id='adminTok' placeholder='admin token' style='width: 200px;'>
      <button onclick='setAdminToken()'>Apply</button>
      <span id='authBadge' class='badge warn'><span class='dot'></span> Admin: off</span>
    </div>
    <div class='row' role='toolbar' aria-label='Project actions'>
      <input id='projName' placeholder='project name' style='width: 160px;'>
      <button onclick='createProj()'>Create</button>
    </div>
    <ul id='projList'></ul>
  </div>
  <div class='card'>
    <div class='row'><span class='key'>project</span><code id='curProj'>–</code></div>
    <div class='row' role='toolbar' aria-label='Notes & files'>
      <div style='flex:1'>
        <h3>Notes</h3>
        <textarea id='notes' placeholder='Project notes...'></textarea>
        <div class='row'><button onclick='saveNotes()'>Save Notes</button> <button onclick='loadNotes()'>Reload</button></div>
      </div>
      <div style='flex:1'>
        <h3>Files</h3>
        <div id='tree' class='card' style='max-height:260px; overflow:auto'></div>
      </div>
    </div>
    <pre id='out'>{}</pre>
  </div>
</div>
<script>
const base=location.origin;
// Lightweight SSE status indicator
try{
  const es = new EventSource(base + '/events');
  es.onopen = ()=>{ const el=document.getElementById('sseBadge'); if (el){ el.innerHTML = "<span class='dot ok'></span> SSE: on"; } };
  es.onerror = ()=>{ const el=document.getElementById('sseBadge'); if (el){ el.innerHTML = "<span class='dot bad'></span> SSE: off"; } };
}catch{}
let current=null;
const ADMIN_STORAGE_KEY='arw_admin_token';
let adminToken='';
function setAdminBadge(on){ const el=document.getElementById('authBadge'); if(!el) return; el.className='badge ' + (on?'ok':'warn'); el.innerHTML = '<span class="dot"></span> Admin: ' + (on?'on':'off'); }
function setAdminToken(){ const tok=(document.getElementById('adminTok')?.value||'').trim(); adminToken=tok; if(tok){ try{ localStorage.setItem(ADMIN_STORAGE_KEY,tok); }catch(_){} } else { try{ localStorage.removeItem(ADMIN_STORAGE_KEY); }catch(_){} } setAdminBadge(!!tok); }
function loadAdminToken(){ try{ const stored=localStorage.getItem(ADMIN_STORAGE_KEY); if(stored){ adminToken=stored; const input=document.getElementById('adminTok'); if(input) input.value=stored; setAdminBadge(true); return; } }catch(_){} setAdminBadge(false); }
async function adminFetch(path, options={}){ const init={ ...options }; init.headers = { ...(options.headers||{}) }; if(adminToken){ init.headers['X-ARW-Admin']=adminToken; }
  const resp = await fetch(base+path, init);
  if(resp.status===401){ setAdminBadge(false); throw new Error('unauthorized'); }
  return resp;
}
function setProj(n){ current=n; document.getElementById('curProj').textContent = n||'–'; if(n){ loadNotes(); loadTree(''); } }
async function listProjs(){ try{ const resp=await adminFetch('/admin/projects/list'); const j=await resp.json().catch(()=>({items:[]})); const ul=document.getElementById('projList'); ul.innerHTML=''; (j.items||[]).forEach(n=>{ const li=document.createElement('li'); li.textContent=n; li.onclick=()=>setProj(n); ul.appendChild(li); }); setAdminBadge(!!adminToken); }catch(err){ document.getElementById('out').textContent='error: '+err.message; } }
async function createProj(){ const n=document.getElementById('projName').value.trim(); if(!n) return; await adminFetch('/admin/projects/create',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name:n})}); await listProjs(); setProj(n); }
async function loadNotes(){ if(!current) return; try{ const resp=await adminFetch('/admin/projects/notes?proj='+encodeURIComponent(current)); const t=await resp.text(); document.getElementById('notes').value=t; }catch(err){ show('error: '+err.message); }}
async function saveNotes(){ if(!current) return; const t=document.getElementById('notes').value||''; try{ await adminFetch('/admin/projects/notes?proj='+encodeURIComponent(current),{method:'POST',headers:{'Content-Type':'text/plain'},body:t+'\n'}); show('saved'); }catch(err){ show('error: '+err.message); }}
function show(s){ document.getElementById('out').textContent=s; setTimeout(()=>{ document.getElementById('out').textContent='{}'; },1200); }
async function loadTree(p){ if(!current) return; try{ const resp=await adminFetch('/admin/projects/tree?proj='+encodeURIComponent(current)+'&path='+encodeURIComponent(p||'')); const j=await resp.json().catch(()=>({items:[]})); const el=document.getElementById('tree'); el.innerHTML=''; (j.items||[]).forEach(it=>{ const d=document.createElement('div'); d.textContent = (it.dir?'📁 ':'📄 ')+it.name; d.style.cursor='pointer'; d.onclick=()=>{ if(it.dir) loadTree(it.rel); }; el.appendChild(d); }); }catch(err){ show('error: '+err.message); }}
document.addEventListener('DOMContentLoaded', ()=>{ loadAdminToken(); listProjs(); });
</script>
