/* tokens.css provides variables */

:root{
  --global-bar-height: 64px;
}

html, body{
  height:100%; margin:0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, sans-serif;
  background: var(--app-background);
  background-color: var(--surface-muted);
  color:var(--color-ink)
}
body[data-ui-mode="expert"]{
  --ui-mode-accent: var(--color-brand-copper);
}
[data-mode="expert-only"]{
  display:none !important;
}
body[data-ui-mode="expert"] [data-mode="expert-only"]{
  display:revert !important;
}
body:not([data-ui-mode]), body[data-ui-mode="guided"]{
  --ui-mode-accent: rgba(var(--brand-copper-rgb),0.25);
}
body[data-ui-mode="expert"] [data-mode="guided-only"]{
  display:none !important;
}
body:not([data-ui-mode]) [data-mode="guided-only"],
body[data-ui-mode="guided"] [data-mode="guided-only"]{
  display:revert !important;
}
/* Responsive type scale */
body{ font-size: clamp(14px, 1.6vw, 16px) }

/* Skip link */
.skip-link{ position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden }
.skip-link:focus{ position:static; width:auto; height:auto; padding:6px 10px; border:1px solid var(--color-line); border-radius:8px; background:#fff; box-shadow: var(--shadow-2); z-index:10000 }
/* Screen-reader only */
.sr-only{ position:absolute !important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0 }

.global-bar{
  position:sticky;
  top:0;
  z-index:800;
  backdrop-filter: blur(10px);
  background: rgba(255,255,255,0.92);
  border-bottom:1px solid rgba(148,163,184,0.3);
  box-shadow: 0 8px 24px rgba(15,23,42,0.08);
}
.global-bar__inner{
  max-width: 1200px;
  margin: 0 auto;
  padding: var(--sp3) var(--sp4);
  display:flex;
  flex-wrap:wrap;
  align-items:flex-start;
  gap: var(--sp4);
}
.global-bar__controls{
  margin-left:auto;
  display:flex;
  align-items:center;
  gap: var(--sp2);
}
.global-bar__mode{
  padding:6px 14px;
  border-radius:999px;
  border:1px solid rgba(148,163,184,0.35);
  background: linear-gradient(180deg,#ffffff,#f6f7f9);
  font-size:0.85rem;
  font-weight:600;
  color: var(--color-muted);
  box-shadow: 0 1px 0 rgba(255,255,255,0.9) inset;
  transition: border-color 0.12s ease, color 0.12s ease, box-shadow 0.12s ease;
}
.global-bar__mode:hover,
.global-bar__mode:focus-visible{
  border-color: rgba(var(--brand-copper-rgb),0.4);
  color: var(--color-brand-copper);
  box-shadow: 0 1px 0 rgba(255,255,255,0.92) inset, 0 10px 24px rgba(15,23,42,0.1);
}
.global-bar__mode:focus-visible{
  outline:2px solid rgba(var(--brand-copper-rgb),0.45);
  outline-offset:2px;
}
.global-bar__brand{
  display:flex;
  flex-direction:column;
  gap:2px;
  text-decoration:none;
  color: var(--color-ink);
  font-weight:600;
}
.global-bar__brand:focus-visible{
  outline-color: rgba(var(--brand-copper-rgb),0.55);
}
.global-bar__brand-title{
  font-size:1rem;
  letter-spacing:0.01em;
}
.global-bar__brand-tag{
  font-size:0.72rem;
  letter-spacing:0.12em;
  text-transform:uppercase;
  color: var(--color-muted);
}
.global-bar__nav{
  display:flex;
  flex-wrap:wrap;
  gap: var(--sp4);
}
.global-bar__group{
  display:flex;
  flex-direction:column;
  gap:6px;
  min-width: 150px;
}
.global-bar__group-label{
  font-size:0.72rem;
  text-transform:uppercase;
  letter-spacing:0.12em;
  color: var(--color-muted);
}
.global-bar__group-links{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
}
.global-bar__link{
  display:flex;
  flex-direction:column;
  gap:2px;
  padding:6px 10px;
  border-radius:8px;
  border:1px solid transparent;
  text-decoration:none;
  color: var(--color-ink);
  font-weight:500;
  background: transparent;
  transition: border-color 0.12s ease, background 0.12s ease;
}
.global-bar__link small{
  font-size:0.74rem;
  color: var(--color-muted);
  font-weight:400;
}
.global-bar__link:hover,
.global-bar__link:focus-visible{
  border-color: rgba(var(--brand-copper-rgb),0.35);
  background: rgba(var(--brand-copper-rgb),0.08);
}
.global-bar__link.is-active{
  border-color: rgba(var(--brand-copper-rgb),0.35);
  background: rgba(var(--brand-copper-rgb),0.12);
}
.global-bar__link.is-active small{
  color: var(--color-brand-copper);
}

@media (prefers-color-scheme: dark){
  .global-bar{
    background: rgba(15,23,42,0.9);
    border-bottom-color: rgba(59,69,90,0.6);
    box-shadow: 0 12px 28px rgba(2,6,23,0.6);
  }
  .global-bar__link{
    color:#e5e7eb;
  }
  .global-bar__link small{
    color: rgba(203,213,225,0.8);
  }
  .global-bar__brand{
    color:#e5e7eb;
  }
  .global-bar__brand-tag{
    color: rgba(148,163,184,0.8);
  }
}

.wrap{ padding:var(--sp4); display:grid; gap:var(--sp4); position:relative }
.wrap::before{
  content:""; position:absolute; inset:0; pointer-events:none;
  background-image: var(--noise);
  opacity:.5; mix-blend-mode: soft-light;
}
.card{ padding:var(--sp5); border:1px solid var(--color-line); border-radius:12px; background: linear-gradient(180deg,#ffffff, #fafafa); box-shadow: var(--shadow-2) }
.row{ display:flex; gap:var(--sp2); flex-wrap:wrap; align-items:center }

button{
  padding:8px 12px; border-radius:8px; border:1px solid #cfd6de;
  background-image: linear-gradient(180deg, #ffffff, #f3f4f6), var(--noise);
  background-blend-mode: overlay, normal; color:#111; cursor:pointer;
  box-shadow: var(--shadow-1), 0 8px 18px rgba(0,0,0,0.06);
  transition: transform .06s ease, box-shadow .12s ease;
}
button:hover{ transform: translateY(-0.5px); box-shadow: 0 1px 0 rgba(255,255,255,0.95) inset, 0 14px 28px rgba(0,0,0,0.08) }
button:active{ transform: translateY(0); box-shadow: 0 0 0 rgba(0,0,0,0.0), 0 4px 8px rgba(0,0,0,0.08) }

button.primary{ border-color: var(--color-brand-copper); background-image: linear-gradient(180deg, var(--color-brand-copper), var(--color-brand-copper-dark)), var(--noise); color:#fff }
button.ghost{
  background: transparent; border-color: #cfd6de;
}
button.link-button{
  padding:0;
  border:none;
  background:none;
  color: var(--status-info);
  box-shadow:none;
  text-decoration:underline;
  cursor:pointer;
}
button.link-button:hover,
button.link-button:focus-visible{
  color: var(--color-brand-copper);
  border:none;
  box-shadow:none;
  transform:none;
}

table{ width:100%; border-collapse:collapse }
th,td{ border-bottom:1px solid #eee; padding:6px 8px; text-align:left }
th{ color:#555; font-weight:600 }

.mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace }
.dim{ color: var(--color-muted) }
.ok{ color: var(--status-ok) }
.bad{ color: var(--status-bad) }

.sse-badge{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:4px 10px;
  border-radius:999px;
  border:1px solid var(--color-line);
  font-size:12px;
  background: linear-gradient(180deg,#ffffff,#f6f7f9);
  box-shadow: 0 1px 0 rgba(255,255,255,0.92) inset;
  transition: border-color 0.2s ease, color 0.2s ease;
}
.sse-badge::before{
  content:"";
  width:8px;
  height:8px;
  border-radius:999px;
  background: var(--color-muted);
  box-shadow: inset 0 0 0 1px rgba(0,0,0,0.06);
}
.sse-badge[data-state="open"]{
  color: var(--status-ok);
  border-color: rgba(var(--status-ok-rgb),0.35);
  box-shadow: 0 1px 0 rgba(255,255,255,0.92) inset, 0 0 0 1px rgba(var(--status-ok-rgb),0.08);
}
.sse-badge[data-state="open"]::before{ background: var(--status-ok); }
.sse-badge[data-state="error"],
.sse-badge[data-state="closed"]{
  color: var(--status-bad);
  border-color: rgba(var(--status-bad-rgb),0.35);
}
.sse-badge[data-state="error"]::before,
.sse-badge[data-state="closed"]::before{ background: var(--status-bad); }
.sse-badge[data-state="stale"]{
  color: var(--status-warn);
  border-color: rgba(var(--status-warn-rgb),0.4);
}
.sse-badge[data-state="stale"]::before{
  background: var(--status-warn);
  animation: sse-pulse 2s ease-in-out infinite;
}
.sse-badge[data-state="connecting"],
.sse-badge[data-state="idle"]{
  color: var(--color-muted);
  border-color: rgba(var(--color-muted-rgb,119,124,133),0.45);
}
.sse-badge[data-state="connecting"]::before{ background: var(--color-muted); animation: sse-pulse 1.2s ease-in-out infinite; }

@keyframes sse-pulse{
  0%,100%{ transform: scale(1); opacity: 0.85; }
  50%{ transform: scale(1.2); opacity: 0.45; }
}

.badge{ display:inline-flex; align-items:center; gap:6px; padding:4px 8px; border:1px solid var(--color-line); border-radius:999px; font-size:12px; background:#fff; box-shadow:0 1px 0 rgba(255,255,255,0.9) inset }
.badge.warn{ border-color: var(--status-warn); color: var(--status-warn) }
.badge.ok{ border-color: var(--status-ok); color: var(--status-ok) }
.badge.bad{ border-color: var(--status-bad); color: var(--status-bad) }
.badge.base-badge{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; font-size:12px; }
.badge.base-badge[data-override="true"]{
  border-color: var(--color-accent-teal-strong);
  color: var(--color-accent-teal-strong);
}
.badge.base-badge[data-state="remote-https"]{
  border-color: var(--color-accent-teal-strong);
  color: var(--color-accent-teal-strong);
}
.badge.base-badge[data-state="remote-http"]{
  border-color: var(--status-warn);
  color: var(--status-warn);
  background: linear-gradient(180deg,#fff8ed,#fff3e2);
}
.badge.base-badge[data-state="loopback"]{
  border-color: var(--color-accent-teal-strong);
  color: var(--color-accent-teal-strong);
  opacity: 0.85;
}
.hero-callout{
  margin-top: var(--sp3);
  padding: var(--sp3);
  border-radius:12px;
  border:1px solid rgba(var(--status-warn-rgb),0.35);
  background: linear-gradient(180deg,#fff8ed,#fff3e2);
  display:flex;
  align-items:flex-start;
  gap: var(--sp3);
  color: var(--color-ink);
  box-shadow: var(--shadow-1);
}
.hero-callout strong{
  display:block;
  color: var(--status-warn);
}
.hero-callout-icon{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:24px;
  height:24px;
  border-radius:999px;
  background: var(--status-warn);
  color:#fff;
  font-weight:700;
  flex-shrink:0;
}
.hero-callout[hidden]{ display:none; }
@media (prefers-color-scheme: dark){
  .hero-callout{
    background: linear-gradient(180deg,#2c1d10,#1c140c);
    border-color: rgba(var(--status-warn-rgb),0.45);
    color: rgba(255,255,255,0.92);
    box-shadow: 0 18px 40px rgba(0,0,0,0.45);
  }
  .hero-callout strong{
    color: rgba(var(--status-warn-rgb),0.85);
  }
  .hero-callout-icon{
    background: rgba(var(--status-warn-rgb),0.85);
  }
}
.context-metrics{ display:grid; gap:var(--sp4); margin:var(--sp3) 0; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
.metric-block{ display:grid; gap:var(--sp2); margin-bottom:var(--sp4); }
.metric-block:last-of-type{ margin-bottom:0; }
.metric-block h4{ margin:0; font-size:1rem; }
.metric-list{ margin:0; padding-left:1.25rem; }
.metric-list li{ margin:0.15rem 0; }
.metric-inline{ margin:0; }
.metric-label{ font-weight:600; margin-right:6px; }
.metric-pill{ display:inline-flex; align-items:center; gap:6px; padding:4px 8px; border-radius:999px; border:1px solid var(--color-line); background:linear-gradient(180deg,#ffffff,#f6f7f9); font-size:0.9rem; }
.metric-pill.ok{ color: var(--status-ok); border-color: rgba(var(--status-ok-rgb),0.35); }
.metric-pill.bad{ color: var(--status-bad); border-color: rgba(var(--status-bad-rgb),0.35); }
.metric-meter{ margin:0 0 var(--sp2); }
.metric-meter .bar{ margin:2px 0 0; height:12px; }
.ratio-bar{ position:relative; }
.ratio-bar>i{ transition: width 0.25s ease; }
.ratio-bar.ok>i{ background: var(--status-ok); }
.ratio-bar.warn>i{ background: var(--status-warn); }
.ratio-bar.bad>i{ background: var(--status-bad); }
.ratio-bar.empty{ opacity:0.7; }
.dot{ width:8px; height:8px; border-radius:999px; background:#aaa; display:inline-block }
.dot.ok{ background: var(--status-ok) }
.dot.bad{ background: var(--status-bad) }
.runtime-runbook{ margin:6px 0 12px; font-size:13px; color: var(--color-muted) }
.runtime-runbook summary{ font-weight:600; cursor:pointer; color: var(--color-ink) }
.runtime-runbook[open] summary{ margin-bottom:4px }
.runtime-runbook p{ margin:0; font-size:13px; line-height:1.45; color: inherit }
.runtime-hints{ margin:12px 0; padding:10px 12px; border:1px solid var(--color-line); border-radius:10px; background: linear-gradient(180deg,#ffffff,#f8fafc); display:grid; gap:6px }
.runtime-hints h4{ margin:0; font-size:14px; font-weight:600; color: var(--color-ink) }
.runtime-hints p{ margin:0; font-size:12px; color: var(--color-muted) }
.runtime-hints p.warn{ color: var(--status-warn); font-weight:600 }
.runtime-hints-actions{ display:flex; flex-wrap:wrap; gap:8px; margin-top:6px }
.runtime-hints-actions .ghost{ display:inline-flex; align-items:center; border:1px solid #cfd6de; border-radius:8px; padding:6px 10px; text-decoration:none; color:inherit; background-image: linear-gradient(180deg, #ffffff, #f3f4f6), var(--noise); box-shadow: var(--shadow-1), 0 8px 18px rgba(0,0,0,0.04); transition: transform .06s ease, box-shadow .12s ease; }
.runtime-hints-actions .ghost:hover,
.runtime-hints-actions .ghost:focus-visible{ transform: translateY(-0.5px); box-shadow: 0 1px 0 rgba(255,255,255,0.95) inset, 0 12px 20px rgba(0,0,0,0.08); border-color: rgba(var(--brand-copper-rgb),0.35); outline:2px solid rgba(var(--brand-copper-rgb),0.5); outline-offset:1px; }
.runtime-hints-actions .ghost.mini{ padding:4px 8px; font-size:12px; border-radius:6px }
.runtime-detail{ margin-top:6px }
.runtime-detail summary{ cursor:pointer; font-size:12px; color: var(--color-muted); font-weight:600 }
.runtime-detail ul{ margin:4px 0 0; padding-left:18px; font-size:12px; color: var(--color-muted) }
.runtime-detail li{ margin-bottom:2px }
table[data-runtime-table] tr[data-runtime-pending="true"]{ background: rgba(15,23,42,0.04); }
table[data-runtime-table] tr[data-runtime-pending="true"] button{ cursor:wait }
.runtime-matrix{ margin-top:16px; border-top:1px solid var(--color-line); padding-top:12px; display:grid; gap:12px }
.runtime-matrix h4{ margin:0; font-size:14px; font-weight:600; color: var(--color-ink) }
.runtime-matrix .matrix-grid{ display:grid; gap:10px; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
.runtime-matrix .matrix-card{ border:1px solid var(--color-line); border-radius:10px; padding:10px; background:linear-gradient(180deg,#ffffff,#f7f7f9); box-shadow: var(--shadow-1); }
.runtime-matrix .matrix-card.bad{ border-color: var(--status-bad); }
.runtime-matrix .matrix-card.warn{ border-color: var(--status-warn); }
.runtime-matrix .matrix-title{ display:flex; justify-content:space-between; align-items:center; gap:8px; font-weight:600; font-size:13px }
.runtime-matrix .matrix-meta{ margin-top:6px; font-size:12px; color: var(--color-muted); display:grid; gap:4px }
.runtime-matrix .matrix-meta code{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; font-size:11px }

.notes-meta{ margin-top:6px; font-size:12px; display:flex; flex-wrap:wrap; gap:12px; color:var(--color-muted) }
.notes-meta.warn{ color: var(--status-warn) }
.tree-meta{ margin-top:6px; font-size:12px; color:var(--color-muted) }
.tree-meta.warn{ color: var(--status-warn) }
.run-details summary{ cursor:pointer; font-weight:600; font-size:13px }
.run-meta{ list-style:none; margin:6px 0 0; padding:0; display:grid; gap:4px; font-size:12px }
.run-meta-label{ font-weight:600; color:var(--color-muted); margin-right:6px }
.run-meta-value{ word-break:break-all }
.run-meta li{ display:flex; flex-wrap:wrap; gap:4px }
.run-meta-empty{ color:var(--color-muted); font-style:italic }
.context-preview{ margin-top:8px; padding:8px 10px; border:1px solid var(--color-line); border-radius:8px; background:linear-gradient(180deg,#f8fafc,#eef2ff); font-size:13px; color:var(--color-muted); white-space:pre-wrap; max-height:180px; overflow:auto }
.context-summary,.context-meta{ margin-top:6px; display:flex; flex-wrap:wrap; gap:12px; font-size:12px; color:var(--color-muted) }
.context-meta code{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; font-size:11px; background:none; padding:0 }
.context-items{ margin-top:12px; display:grid; gap:10px }
.context-item{ border:1px solid var(--color-line); border-radius:10px; padding:10px 12px; background:linear-gradient(180deg,#ffffff,#f7f7f9); box-shadow: var(--shadow-1); }
.context-item-header{ display:flex; flex-wrap:wrap; gap:8px; align-items:center }
.context-item-header > span:first-child{ font-weight:600; color:var(--color-ink) }
.context-lane{ font-size:11px; letter-spacing:.05em; text-transform:uppercase; color:var(--color-muted) }
.context-item-score{ font-size:12px; color:var(--color-muted) }
.context-item-body{ margin-top:6px; font-size:13px; color:var(--color-ink); white-space:pre-wrap; word-break:break-word }
.context-tags{ margin-top:6px; font-size:12px; color:var(--color-muted); display:flex; flex-wrap:wrap; gap:8px }
.context-pointer{ margin-top:8px; display:flex; flex-wrap:wrap; gap:8px; align-items:center; font-size:12px; color:var(--color-muted) }
.context-pointer .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; font-size:12px; color:var(--color-ink) }
.context-pointer code{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; font-size:12px; background:none; border:none; padding:0; white-space:nowrap }
.context-actions{ display:flex; gap:6px; flex-wrap:wrap }
.context-empty{ font-size:13px; color:var(--color-muted); padding:8px 0 }
.provenance-card{ border:1px solid var(--color-line); border-radius:10px; padding:10px 12px; background:linear-gradient(180deg,#ffffff,#f8fafc); box-shadow:var(--shadow-1); margin-bottom:8px }
.provenance-card .prov-body{ display:grid; gap:6px; margin-top:6px; font-size:12px; color:var(--color-ink) }
.provenance-card .prov-row{ display:flex; flex-wrap:wrap; gap:6px; align-items:center }
.provenance-card .prov-row .pill{ font-size:11px; text-transform:uppercase; letter-spacing:.05em }
.provenance-card .row{ margin-top:8px }
.context-restore{ display:none; flex-direction:column; gap:6px; margin-top:12px }
.context-restore.active{ display:flex }
.context-restore .row{ align-items:center; gap:8px }

.bar{ height:8px; border:1px solid var(--color-line); border-radius:8px; overflow:hidden; margin:4px 0; background:linear-gradient(180deg,#fff,#f7f7f7) }
.bar>i{ display:block; height:8px; width:0%; background: linear-gradient(90deg, var(--color-accent-teal), var(--color-accent-teal-light)) }

.toast-wrap{ position:fixed; right:16px; bottom:16px; display:flex; flex-direction:column; gap:8px; z-index: 9999 }
.toast{ background: #0f172a; color:#fff; padding:8px 12px; border-radius:10px; opacity:.95; box-shadow: 0 14px 34px rgba(0,0,0,0.22) }

input, select, textarea{ font:inherit; color:var(--color-ink); border:1px solid var(--color-line); border-radius:8px; padding:6px 8px; background:#ffffff; box-shadow: 0 1px 0 rgba(255,255,255,0.9) inset }
input:focus, select:focus, textarea:focus{ outline: none; border-color: var(--color-brand-copper); box-shadow: 0 0 0 3px rgba(var(--brand-copper-rgb), 0.15) }

/* Iconography */
.icons{ display:inline-flex; gap:6px; align-items:center; margin-right:6px }
.ico{ width:14px; height:14px; display:inline-block; vertical-align:-2px; color:currentColor; opacity:.9 }
.ico.ok{ color: var(--status-ok) }
.ico.warn{ color: var(--status-warn) }
.ico.bad{ color: var(--status-bad) }
.ico.info{ color: var(--color-muted) }
.ico.accent{ color: var(--color-accent-teal-strong) }

/* Better keyboard focus */
button:focus-visible, a:focus-visible, input:focus-visible, select:focus-visible, textarea:focus-visible{ outline: 2px solid rgba(var(--brand-copper-rgb), 0.55); outline-offset: 2px }

/* Touch-friendly targets */
@media (pointer: coarse){
  button{ padding:12px 16px; border-radius:10px }
  input, select, textarea{ padding:10px 12px }
}

/* Reduce motion when requested */
@media (prefers-reduced-motion: reduce){
  *{ transition: none !important; animation: none !important }
}

/* Dark mode tuning */
@media (prefers-color-scheme: dark){
  html, body{
    background: var(--app-background);
    background-color: var(--surface-muted);
  }
  .card{ background: linear-gradient(180deg,#12161f,#0f141a); border-color: var(--color-line); box-shadow: 0 12px 30px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.04) }
  button{ color:#e5e7eb; border-color:#39404a; box-shadow: 0 1px 0 rgba(255,255,255,0.06) inset, 0 8px 18px rgba(0,0,0,0.35); background-image: linear-gradient(180deg,#1a202b,#131822), var(--noise) }
  button.primary{ background-image: linear-gradient(180deg, var(--color-brand-copper-dark), #6f3e1d), var(--noise) }
  .sse-badge{ background: linear-gradient(180deg,#111827,#0f172a); border-color: var(--color-line); box-shadow: 0 1px 0 rgba(255,255,255,0.05) inset, 0 0 0 1px rgba(15,23,42,0.45); }
  .sse-badge::before{ box-shadow: none; }
  .sse-badge[data-state="open"]{ border-color: rgba(var(--status-ok-rgb),0.45); }
  .sse-badge[data-state="error"],
  .sse-badge[data-state="closed"]{ border-color: rgba(var(--status-bad-rgb),0.45); }
  .sse-badge[data-state="stale"]{ border-color: rgba(var(--status-warn-rgb),0.55); }
  .badge{ background:#12161f; border-color: var(--color-line); box-shadow: 0 1px 0 rgba(255,255,255,0.06) inset }
  .bar{ background: linear-gradient(180deg, #0f141a, #0b0f15) }
  .bar>i{ background: linear-gradient(90deg, var(--color-accent-teal), #12897f) }
  .metric-pill{ background: linear-gradient(180deg,#111827,#0f172a); border-color: var(--color-line); }
  input, select, textarea{ background:#0f141a; color:#e5e7eb; border-color: var(--color-line); box-shadow: 0 1px 0 rgba(255,255,255,0.06) inset }
  .arw-sidecar .approval-card{ background: linear-gradient(180deg,#111827,#0f172a); box-shadow: inset 0 1px 0 rgba(255,255,255,0.05); border-color: var(--color-line) }
  .arw-sidecar .approval-card.stale{ border-color: var(--status-warn); background: linear-gradient(180deg,#1f2937,#7c2d12); box-shadow: 0 0 0 1px rgba(217,119,6,0.25) }
  .arw-sidecar .approval-evidence-json{ background: rgba(15,23,42,0.45) }
  button.btn-small.ghost{ border-color:#39404a }
  .context-preview{ background: linear-gradient(180deg,#111827,#0f172a); border-color: var(--color-line); color: var(--color-muted) }
  .context-item{ background: linear-gradient(180deg,#12161f,#0f141a); border-color: var(--color-line); box-shadow: 0 12px 24px rgba(0,0,0,0.35) }
  .context-pointer .mono{ color:#e5e7eb }
}

/* Sidecar scaffold */
.layout {
  display:grid; grid-template-columns: 1fr 320px; gap: var(--sp4);
}
.layout.full { grid-template-columns: 1fr }
.arw-sidecar {
  position:sticky; top:12px; align-self:start;
  border:1px solid var(--color-line); border-radius:12px; padding:8px;
  background: linear-gradient(180deg,#ffffff,#fafafa);
  box-shadow: 0 12px 30px rgba(0,0,0,0.06), inset 0 1px 0 rgba(255,255,255,0.65);
}
.arw-sidecar section { border-bottom:1px dashed var(--color-line); padding:4px 0 }
.arw-sidecar section:last-child{ border-bottom:none }
.arw-sidecar h3 { margin:6px 0; font-size:14px; color:#374151; display:flex; align-items:center; }
.arw-sidecar h3 .lane-toggle{
  background:none;
  border:none;
  color:inherit;
  font:inherit;
  padding:2px 0;
  width:100%;
  text-align:left;
  display:flex;
  align-items:center;
  gap:6px;
  cursor:pointer;
}
.arw-sidecar h3 .lane-toggle:focus-visible{
  outline:2px solid var(--color-ink);
  outline-offset:2px;
}
.arw-sidecar section.collapsed > .lane-body { display:none }
.arw-sidecar .lane-summary { margin:8px 0 12px; font-size:12px; color: var(--color-muted); display:none }
.arw-sidecar .lane-summary:not([hidden]) { display:block }
.provenance-summary { display:grid; gap:8px }
.provenance-summary-counts { display:flex; flex-wrap:wrap; gap:8px; align-items:center; font-size:12px }
.provenance-summary-counts .pill.warn { border-color: var(--status-warn); color: var(--status-warn) }
.provenance-summary-counts .pill.bad { border-color: var(--status-bad); color: var(--status-bad) }
.provenance-summary-counts .pill.good { border-color: rgba(var(--status-ok-rgb),0.35); color: var(--status-ok) }
.provenance-summary-updated { font-size:11px; color: var(--color-muted) }
.provenance-summary-list { list-style:none; margin:0; padding:0; display:grid; gap:6px }
.provenance-summary-item { display:flex; flex-wrap:wrap; gap:6px; align-items:center; font-size:12px; color: var(--color-ink) }
.provenance-summary-item .provenance-summary-title { font-weight:600 }
.provenance-summary-item .pill { font-size:11px }
.provenance-summary-item time { font-size:11px; color: var(--color-muted) }
.provenance-summary-preview { width:100%; font-size:12px; color: var(--color-muted); margin-top:4px }
.provenance-summary-empty { font-size:12px; color: var(--color-muted) }
.arw-sidecar .lane-body { max-height: 260px; overflow:auto }
.arw-sidecar .lane-placeholder{
  font-size:12px;
  color: var(--color-muted);
  line-height:1.45;
  padding:4px 0 12px;
}
.arw-sidecar .evt { font-size:12px; padding:2px 0 }
.arw-sidecar .approval-summary{ display:flex; align-items:center; justify-content:space-between; gap:6px; font-size:12px; color:var(--color-muted); margin-bottom:6px }
.arw-sidecar .approval-summary strong{ color:var(--color-ink); font-weight:600 }
.arw-sidecar .approval-summary time{ font-size:11px; color:inherit }
.arw-sidecar .approval-card{ border:1px solid var(--color-line); border-radius:10px; padding:6px 8px; margin-bottom:8px; background: linear-gradient(180deg,#ffffff,#f6f7f9); box-shadow: inset 0 1px 0 rgba(255,255,255,0.65) }
.arw-sidecar .approval-card.stale{ border-color: var(--status-warn); box-shadow: 0 0 0 1px rgba(217,119,6,0.2), inset 0 1px 0 rgba(255,255,255,0.65); background: linear-gradient(180deg,#fff7ed,#fef3c7) }
.arw-sidecar .approval-card:last-child{ margin-bottom:0 }
.arw-sidecar .approval-head{ display:flex; gap:6px; flex-wrap:wrap; align-items:center; margin-bottom:4px }
.arw-sidecar .approval-meta{ display:flex; gap:12px; flex-wrap:wrap; color:var(--color-muted); font-size:12px; margin-bottom:4px }
.arw-sidecar .approval-meta time{ color:inherit }
.arw-sidecar .approval-details{ margin-top:6px }
.arw-sidecar .approval-details summary{ cursor:pointer; font-weight:600 }
.arw-sidecar .approval-evidence{ display:grid; gap:6px; font-size:12px }
.arw-sidecar .approval-evidence-head{ display:flex; align-items:center; justify-content:space-between; gap:8px }
.arw-sidecar .approval-evidence-json{ background:rgba(15,23,42,0.04); border-radius:6px; padding:6px; font-size:11px; margin:0; max-height:160px; overflow:auto }
.arw-sidecar .approval-recent{ margin-top:8px }
.arw-sidecar .approval-recent ul{ margin:0; padding-left:16px }
.arw-sidecar .approval-recent li{ font-size:12px; margin-bottom:4px }
.arw-sidecar .approval-filter{ margin:4px 0; align-items:center; gap:6px }
.arw-sidecar .approval-filter input{ flex:1; min-width:0 }
.arw-sidecar .approval-filter-chips{ margin-bottom:6px; gap:6px }
.arw-sidecar .approval-filter-chips button.active{
  border-color: var(--color-accent-teal-strong);
  color: var(--color-accent-teal-strong);
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.6);
}
.arw-sidecar .approval-filter-chips button[data-shortcut]::after{ content:"Alt+" attr(data-shortcut); font-size:11px; color:var(--color-muted); margin-left:6px }
.arw-sidecar .approval-stale{ margin:4px 0; align-items:center; gap:6px }
.arw-sidecar .approval-stale select{ flex:0 0 auto }
.arw-sidecar .approval-sort{ margin:4px 0; align-items:center; gap:6px }
.arw-sidecar .approval-sort select{ flex:0 0 auto }
.arw-sidecar .approval-reviewer{ display:flex; align-items:center; justify-content:space-between; gap:8px; font-size:12px; margin:4px 0 8px }
.arw-sidecar .approval-reviewer .dim{ flex:1 }
.arw-sidecar .approval-project-stats{ margin-top:8px }
.arw-sidecar .approval-project-stats-header{ align-items:center; justify-content:space-between; margin-bottom:4px }
.arw-sidecar .approval-project-stats ul{ list-style:none; padding-left:0; margin:4px 0 0; display:grid; gap:4px }
.arw-sidecar .approval-project-stats li{ display:flex; align-items:center; gap:6px; font-size:12px }
.arw-sidecar .approval-project-stats .badge{ font-size:11px }
.arw-sidecar .approval-actions{ margin-top:6px }
.arw-sidecar .approval-actions button{ flex:0 0 auto }
button.btn-small{ padding:4px 8px; font-size:12px; box-shadow:none }
button.btn-small.ghost{ border-color:#d5dbe4 }
.arw-sidecar .context-msg{
  font-size:12px;
  color:var(--color-muted);
  padding:10px 12px;
  border:1px dashed var(--color-line);
  border-radius:10px;
  background:linear-gradient(180deg,#ffffff,#f8fafc);
}
.arw-sidecar .context-msg.warn{
  color:var(--status-warn);
  border-color: rgba(var(--status-warn-rgb,217,119,6),0.6);
}
.arw-sidecar .context-item{ border:1px solid var(--color-line); border-radius:10px; padding:8px; margin-bottom:8px; background:linear-gradient(180deg,#ffffff,#f6f7f9); box-shadow: inset 0 1px 0 rgba(255,255,255,0.75) }
.arw-sidecar .context-item:last-child{ margin-bottom:0 }
.arw-sidecar .context-head{ display:flex; align-items:flex-start; justify-content:space-between; gap:8px; margin-bottom:4px }
.arw-sidecar .context-title{ font-weight:600; font-size:13px; line-height:1.35 }
.arw-sidecar .context-badges{ display:flex; flex-wrap:wrap; gap:6px }
.arw-sidecar .context-excerpt{ font-size:12px; line-height:1.45; margin:2px 0 6px; color:var(--color-ink) }
.arw-sidecar .context-trace{ font-size:11px; color:var(--color-muted); margin-bottom:4px }
.arw-sidecar .context-pointer-block{ border:1px dashed #d5dbe4; border-radius:8px; padding:6px; margin:6px 0; background:rgba(15,23,42,0.02) }
.arw-sidecar .context-pointer{ display:flex; align-items:center; justify-content:space-between; gap:8px; flex-wrap:wrap }
.arw-sidecar .context-pointer-label{ font-size:12px; font-weight:500; color:var(--color-ink) }
.arw-sidecar .context-pointer-buttons{ display:flex; gap:6px; flex-wrap:wrap }
.arw-sidecar .context-pointer-preview{ margin-top:6px; font-size:12px; background:rgba(15,23,42,0.04); border-radius:6px; padding:6px; max-height:220px; overflow:auto }
.arw-sidecar .context-pointer-preview pre{ margin:0; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; font-size:11px; white-space:pre-wrap; word-break:break-word }
.arw-sidecar .context-pointer-preview .context-preview-meta{ font-size:11px; color:var(--color-muted); margin-bottom:4px }
.arw-sidecar .context-more{ margin-top:6px }
.arw-sidecar .context-more summary{ cursor:pointer; font-size:12px; color:var(--color-muted) }

/* Panels grid helpers */
.grid { display:grid; gap: var(--sp3) }
.grid.cols-2 { grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)) }
.grid.cols-3 { grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)) }

/* Command Palette */
.palette-wrap{ position: fixed; inset:0; display:none; place-items:center; background: rgba(4,7,12,0.35); backdrop-filter: blur(4px) saturate(120%); z-index:99999 }
.palette{ width:min(720px, 92vw); background: linear-gradient(180deg,#ffffff,#f6f7f9); border:1px solid var(--color-line); border-radius:12px; box-shadow: 0 18px 50px rgba(0,0,0,0.18) }
.palette header{ padding:10px 12px; border-bottom:1px solid var(--color-line); display:flex; gap:8px; align-items:center }
.palette header input{ width:100% }
.palette ul{ list-style:none; margin:0; padding: 6px 0; max-height: 50vh; overflow:auto }
.palette li{ padding:8px 12px; display:flex; align-items:center; gap:8px; cursor:pointer }
.palette li:hover, .palette li.active{ background:#f3f4f6 }
.palette .k{ font-size:12px; color:var(--color-muted) }
.palette .hint{ margin-left:auto; color:var(--color-muted); font-size:12px }

/* Compare panel */
.cmp-tabs{ display:flex; gap:6px; margin-bottom:6px }
.cmp-tabs button{ padding:6px 10px }
.cmp-tabs button.active{ border-color:#b87333 }
.cmp-code{ background:linear-gradient(180deg,#ffffff,#fafafa); border:1px solid var(--color-line); border-radius:8px; padding:8px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; font-size:12px; overflow:auto; max-height: 260px }
.cmp-line.add{ background: #ecfdf5 }
.cmp-line.del{ background: #fef2f2 }
.hl-key{ color:var(--color-muted) }
.hl-str{ color:#166534 }
.hl-num{ color:#1d4ed8 }
.hl-bool{ color:#b45309 }
.hl-null{ color:#9ca3af }
/* Inline name highlight for file search */
.hl-match{ background: rgba(27,179,163,0.15); border-bottom: 1px solid var(--color-accent-teal); border-radius: 3px; }
/* Focus styling for file tree rows */
[data-row="1"]:focus{ outline: 2px solid rgba(var(--brand-copper-rgb), 0.5); outline-offset: 2px; background: rgba(27,179,163,0.06) }
/* Compact controls */
.controls{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin:6px 0 }
.controls .spacer{ flex:1 }
.pill{ display:inline-flex; gap:6px; align-items:center; padding:4px 8px; border:1px solid var(--color-line); border-radius:999px; background: linear-gradient(180deg,#ffffff,#f6f7f9); font-size:12px }
.pill .tag{ font-weight:600; color:#374151 }
.scope-tag{ display:inline-flex; align-items:center; border:1px solid var(--color-accent-teal); color:var(--color-accent-teal); border-radius:999px; padding:2px 8px; font-size:11px }
.badge-row{ display:flex; flex-wrap:wrap; gap:var(--sp2); align-items:center }
.action-menu{ position:relative; display:inline-flex; flex-direction:column; align-items:stretch }
.action-menu .menu-toggle{ display:flex; align-items:center; gap:6px }
.action-menu .menu-list{
  position:absolute;
  top:calc(100% + 6px);
  right:0;
  display:flex;
  flex-direction:column;
  gap:4px;
  padding:8px;
  border:1px solid var(--color-line);
  border-radius:10px;
  background: linear-gradient(180deg,#ffffff,#f7f7f9);
  box-shadow: var(--shadow-2);
  min-width: 200px;
  z-index: 999;
}
.action-menu .menu-list[hidden]{ display:none }
.action-menu .menu-item{ width:100%; justify-content:flex-start }

@media (prefers-contrast: more){
  html, body{ background: #ffffff !important; color: var(--color-ink) }
  .wrap::before{ display: none }
  .card{ border-width: 2px; box-shadow: none; background: #ffffff }
  .palette{ box-shadow: none; border-width: 2px }
  .palette li:hover, .palette li.active{ background: #e5e7eb }
  .toast{ box-shadow: none }
  .action-menu .menu-list{
    border-width:2px;
    box-shadow:none;
    background:#ffffff;
  }
}

@media (forced-colors: active){
  html, body{ background: Canvas !important; color: CanvasText !important }
  .wrap::before{ display: none }
  .card{ background: Canvas; color: CanvasText; border: 1px solid ButtonText; box-shadow: none }
  .badge, .pill{ border-color: ButtonText }
  .palette{ background: Canvas; color: CanvasText; border: 1px solid ButtonText; box-shadow: none }
  .palette li:hover, .palette li.active{ background: Highlight; color: HighlightText }
  .toast{ background: CanvasText; color: Canvas; box-shadow: none }
  .action-menu .menu-list{
    background: Canvas;
    color: CanvasText;
    border: 1px solid ButtonText;
  }
}

/* Image slider */
.img-compare{ position: relative; height: 260px; border:1px solid var(--color-line); border-radius:8px; overflow:hidden; background:#111 }
.img-compare img{ position:absolute; inset:0; width:100%; height:100%; object-fit:contain }
.img-compare .top{ clip-path: inset(0 50% 0 0) }
.img-compare input[type=range]{ position:absolute; left:0; right:0; bottom:8px; width: 60%; margin: 0 auto; display:block }

/* Table/CSV compare */
.cmp-summary{ margin:6px 0; color:#374151; font-size:13px }
.cmp-table{ width:100%; border-collapse: collapse; font-size:12px }
.cmp-table th, .cmp-table td{ border-bottom:1px solid #eee; padding:4px 6px }
.cmp-row.add td{ background:#ecfdf5 }
.cmp-row.del td{ background:#fef2f2 }
.cmp-cell.diff{ background: linear-gradient(180deg,#fff7ed,#fffbeb) }

/* Sparkline */
.spark{ width:90px; height:18px; display:inline-block }
/* Screenshots gallery */
.gallery-wrap{ position: fixed; inset:0; display:none; grid-template-rows: auto 1fr; background: rgba(4,7,12,0.55); backdrop-filter: blur(6px) saturate(120%); z-index:99999 }
.gallery{ margin: 6vh auto; width:min(1000px, 94vw); background: linear-gradient(180deg,#ffffff,#f6f7f9); border:1px solid var(--color-line); border-radius:12px; box-shadow: 0 20px 60px rgba(0,0,0,0.25); display:grid; grid-template-rows:auto 1fr }
.gallery header{ padding:10px 12px; border-bottom:1px solid var(--color-line); display:flex; gap:8px; align-items:center }
.gallery main{ padding:12px; overflow:auto }
.grid-thumbs{ display:grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap:12px }
.thumb{ border:1px solid var(--color-line); border-radius:8px; padding:8px; background:linear-gradient(180deg,#ffffff,#fafafa) }
.thumb img{ width:100%; height:140px; object-fit:contain; display:block; background:#111 }
.thumb .row{ margin-top:6px }

/* Region capture overlay */
.region-wrap{ position: fixed; inset:0; z-index:99998; cursor: crosshair; display:none }
.region-dim{ position:absolute; inset:0; background: rgba(0,0,0,0.35); backdrop-filter: blur(1px); }
.region-rect{ position:absolute; border:2px solid var(--color-accent-teal); background: rgba(27,179,163,0.15); box-shadow: 0 0 0 1px rgba(0,0,0,0.2) inset }
.region-hint{ position:absolute; top:10px; left:50%; transform:translateX(-50%); color:#fff; background: rgba(0,0,0,0.6); padding:6px 10px; border-radius:8px; font-size:12px; z-index:1 }

/* Annotation overlay */
.annot-wrap{ position: fixed; inset:0; z-index:99998; display:none }
.annot-dim{ position:absolute; inset:0; background: rgba(0,0,0,0.55); backdrop-filter: blur(2px) }
.annot-panel{ position:absolute; top:6vh; left:50%; transform:translateX(-50%); width:min(96vw, 1100px); height:min(88vh, 820px); background: linear-gradient(180deg,#fff,#f7f7f9); border:1px solid var(--color-line); border-radius:12px; box-shadow: 0 20px 60px rgba(0,0,0,0.25); display:grid; grid-template-rows:auto 1fr auto }
.annot-panel header{ padding:10px 12px; border-bottom:1px solid var(--color-line); display:flex; gap:8px; align-items:center }
.annot-canvas{ position:relative; overflow:auto; background:#111 }
.annot-canvas img{ display:block; margin:0 auto; max-width:100%; max-height:100%; }
.ann-rect{ position:absolute; border:2px solid var(--color-accent-teal); background: rgba(27,179,163,0.12) }
.annot-panel footer{ padding:10px 12px; border-top:1px solid var(--color-line); display:flex; gap:8px; align-items:center; justify-content:flex-end }
.annot-toolbar{ margin-left:auto }
