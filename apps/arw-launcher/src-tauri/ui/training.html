<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ARW Training Park</title>
    <link rel="stylesheet" href="tokens.css" />
    <link rel="stylesheet" href="ui-kit.css" />
    <link rel="stylesheet" href="common.css" />
    <style>
      .metric-block { display: grid; gap: var(--sp2); margin-bottom: var(--sp4); }
      .metric-block:last-of-type { margin-bottom: 0; }
      .metric-block h4 { margin: 0; font-size: 1rem; }
      .metric-list { margin: 0; padding-left: 1.25rem; }
      .metric-list li { margin: 0.15rem 0; }
      .metric-pill { display: inline-flex; align-items: center; gap: 6px; padding: 4px 8px; border-radius: 999px; border: 1px solid var(--color-line); background: linear-gradient(180deg,#ffffff,#f6f7f9); font-size: 0.9rem; }
      .metric-pill.ok { color: var(--status-ok); border-color: rgba(var(--status-ok-rgb),0.35); }
      .metric-pill.bad { color: var(--status-bad); border-color: rgba(var(--status-bad-rgb),0.35); }
      .metric-label { font-weight: 600; margin-right: 6px; }
      #contextTelemetryBody { display: grid; gap: var(--sp4); }
      .metric-inline { margin: 0; }
      .metric-meter { margin: 0 0 var(--sp2); }
      .metric-meter:last-child { margin-bottom: 0; }
      .metric-meter .bar { margin: 2px 0 0; height: 12px; }
      .ratio-bar { position: relative; }
      .ratio-bar>i { transition: width 0.25s ease; }
      .ratio-bar.ok>i { background: var(--status-ok); }
      .ratio-bar.warn>i { background: var(--status-warn); }
      .ratio-bar.bad>i { background: var(--status-bad); }
      .ratio-bar.empty>i { background: rgba(148,163,184,0.45); }
      .ratio-bar.empty { opacity: 0.7; }
      .jobs-table tr.focused-row { outline: 2px solid rgba(var(--brand-copper-rgb), 0.6); outline-offset: 1px; background: rgba(27,179,163,0.08); }
      .jobs-table tr:focus { outline: none; }
      .jobs-table .hint { display: block; margin-top: 2px; font-size: 0.85rem; color: var(--color-muted); }
    </style>
    <script src="common.js" defer></script>
    <script src="training.js" defer></script>
  </head>
  <body>
    <a href="#results" class="skip-link">Skip to results</a>
    <div class="wrap">
      <header class="row">
        <strong>Training Park</strong>
        <label>Port: <input id="port" type="number" min="1" max="65535" value="8091"></label>
        <span id="baseBadge" class="badge base-badge mono" aria-live="polite"></span>
        <button id="abRun" class="primary">Run A/B</button>
        <span id="statusBadges" class="badges" style="margin-left:auto"></span>
        <span id="sseStat" class="dim" role="status" aria-live="polite">SSE: off</span>
        <button id="btn-shortcuts" class="ghost" title="Show keyboard shortcuts">Shortcuts</button>
        <button id="btn-help" class="ghost" title="Open keyboard shortcuts docs">Help</button>
      </header>
      <div class="layout">
        <main class="grid cols-3" role="region" aria-label="Training panels">
          <section class="card" role="region" aria-labelledby="controlsTitle">
            <h3 id="controlsTitle">Controls</h3>
            <div class="row">
              <label for="presetSelect">Preset</label>
              <select id="presetSelect">
                <option value="performance">performance</option>
                <option value="balanced" selected>balanced</option>
                <option value="power-saver">power-saver</option>
              </select>
            </div>
            <div class="row">
              <label for="diversitySlider">Diversity</label>
              <input id="diversitySlider" type="range" min="0" max="1" step="0.05" value="0.50" aria-describedby="diversityValue" />
              <span id="diversityValue" class="mono">0.50</span>
            </div>
            <div class="row">
              <label for="recencySlider">Recency</label>
              <input id="recencySlider" type="range" min="0" max="1" step="0.05" value="0.50" aria-describedby="recencyValue" />
              <span id="recencyValue" class="mono">0.50</span>
            </div>
            <div class="row">
              <label for="compressionSlider">Compression</label>
              <input id="compressionSlider" type="range" min="0" max="1" step="0.1" value="0.50" aria-describedby="compressionValue" />
              <span id="compressionValue" class="mono">0.50</span>
            </div>
            <div class="metric-block" id="governorHistoryBlock">
              <h4>Recent governor profiles</h4>
              <ul id="governorHistoryList" class="metric-list"></ul>
              <div class="row">
                <button id="clearGovernorHistory" class="ghost" type="button">Clear history</button>
              </div>
            </div>
          </section>
          <section class="card" role="region" aria-labelledby="contextTitle">
            <div class="row" style="justify-content: space-between; align-items: center;">
              <h3 id="contextTitle">Context Telemetry</h3>
              <button id="refreshTelemetry" class="ghost" type="button">Refresh</button>
            </div>
            <p id="contextTelemetryStatus" class="dim mono">Loading…</p>
            <div id="contextTelemetryBody" hidden>
              <div class="metric-block" aria-live="polite">
                <h4>Coverage</h4>
                <span id="coverageNeedsMore" class="metric-pill">—</span>
                <p class="metric-inline"><span class="metric-label" id="coverageRatioLabel">Needs more ratio:</span><span id="coverageRatio">—</span></p>
                <div class="metric-meter">
                  <div id="coverageRatioBar" class="bar ratio-bar empty" role="meter" aria-labelledby="coverageRatioLabel" aria-describedby="coverageRatio" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0" aria-valuetext="No data">
                    <i></i>
                  </div>
                </div>
                <div>
                  <strong>Top reasons</strong>
                  <ul id="coverageReasons" class="metric-list"></ul>
                </div>
                <div>
                  <strong>Top slot gaps</strong>
                  <ul id="coverageTopSlots" class="metric-list"></ul>
                </div>
              </div>
              <div class="metric-block" aria-live="polite">
                <h4>Recall risk</h4>
                <p class="metric-inline"><span class="metric-label" id="recallAvgScoreLabel">Average risk score:</span><span id="recallAvgScore">—</span></p>
                <div class="metric-meter">
                  <div id="recallAvgScoreBar" class="bar ratio-bar empty" role="meter" aria-labelledby="recallAvgScoreLabel" aria-describedby="recallAvgScore" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0" aria-valuetext="No data">
                    <i></i>
                  </div>
                </div>
                <p class="metric-inline"><span class="metric-label" id="recallAtRiskLabel">At-risk ratio:</span><span id="recallAtRisk">—</span></p>
                <div class="metric-meter">
                  <div id="recallAtRiskBar" class="bar ratio-bar empty" role="meter" aria-labelledby="recallAtRiskLabel" aria-describedby="recallAtRisk" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0" aria-valuetext="No data">
                    <i></i>
                  </div>
                </div>
                <div>
                  <strong>Top slot gaps</strong>
                  <ul id="recallTopSlots" class="metric-list"></ul>
                </div>
              </div>
              <div class="metric-block" aria-live="polite">
                <h4>Latest assembly</h4>
                <p class="metric-inline mono" id="contextSummaryCounts">—</p>
                <p class="metric-inline" id="contextSpecSummary">—</p>
              </div>
              <div class="metric-block" aria-live="polite">
                <h4>Policy capsules</h4>
                <p class="metric-inline" id="capsuleAccessibleSummary">—</p>
                <p class="metric-inline"><span class="metric-label">Next expiry:</span><span id="capsuleNextExpiry">—</span></p>
                <div>
                  <strong>Status totals</strong>
                  <ul id="capsuleStatusCounts" class="metric-list"></ul>
                </div>
                <div>
                  <strong>Sample</strong>
                  <ul id="capsuleSample" class="metric-list"></ul>
                </div>
              </div>
            </div>
          </section>
          <section class="card" role="region" aria-labelledby="resultsTitle">
            <div class="row" style="justify-content: space-between; align-items: center;">
              <h3 id="resultsTitle" title="↑/↓ to move • Enter to toggle details • Shift+A apply • Shift+D dry-run">Training jobs</h3>
              <button id="refreshJobs" class="ghost" type="button">Refresh</button>
            </div>
            <div class="row" style="align-items: center; gap: var(--sp2);">
              <label for="jobStatusFilter">Status</label>
              <select id="jobStatusFilter">
                <option value="all" selected>All</option>
                <option value="running">Running</option>
                <option value="completed">Completed</option>
                <option value="queued">Queued</option>
                <option value="failed">Failed</option>
              </select>
              <button id="resetDismissedJobs" class="ghost" type="button">Show hidden</button>
            </div>
            <p id="jobsStatus" class="dim mono">Loading…</p>
            <div id="results" class="mono"></div>
            <div id="logicUnitHistory" class="metric-block" aria-live="polite"></div>
            <div class="row" style="margin-top: var(--sp2); align-items: center;">
              <button id="exportHistory" class="ghost" type="button">Download history (JSON)</button>
            </div>
          </section>
          <section class="card" role="region" aria-labelledby="shortcutsTitle">
            <h3 id="shortcutsTitle">Keyboard shortcuts</h3>
            <ul class="metric-list">
              <li><strong>↑ / ↓</strong> — focus previous/next job</li>
              <li><strong>Enter</strong> — toggle job details</li>
              <li><strong>Shift + A</strong> — apply suggestion for focused job</li>
              <li><strong>Shift + D</strong> — dry-run suggestion for focused job</li>
            </ul>
          </section>
        </main>
        <aside id="sidecar"></aside>
      </div>
    </div>
  </body>
  </html>
