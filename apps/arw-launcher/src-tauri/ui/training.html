<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ARW Training Park</title>
    <link rel="stylesheet" href="tokens.css" />
    <link rel="stylesheet" href="ui-kit.css" />
    <link rel="stylesheet" href="common.css" />
    <link rel="stylesheet" href="training.css" />
    <script src="common.js" defer></script>
    <script src="training.js" defer></script>
  </head>
  <body data-page="training">
    <a href="#results" class="skip-link">Skip to results</a>
    <div class="wrap">
      <header class="training-head">
        <div class="training-top">
          <div class="training-primary">
            <strong>Training Park</strong>
            <p>Shape cascades and governors, then measure how changes land before you promote them.</p>
          </div>
          <button id="abRun" class="primary">Run A/B</button>
        </div>
        <div class="training-meta">
          <label>Port: <input id="port" type="number" min="1" max="65535" value="8091"></label>
          <span id="baseBadge" class="badge base-badge mono" aria-live="polite"></span>
          <div class="training-status">
            <span id="statusBadges" class="badges"></span>
            <span id="sseStat" class="dim" role="status" aria-live="polite">SSE: off</span>
          </div>
          <button id="btn-shortcuts" class="ghost" title="Show keyboard shortcuts">Shortcuts</button>
          <button id="btn-help" class="ghost" title="Open keyboard shortcuts docs">Help</button>
        </div>
      </header>
      <div id="baseCallout" class="hero-callout" role="alert" hidden>
        <span class="hero-callout-icon" aria-hidden="true">!</span>
        <span>
          <strong>Secure remote access.</strong>
          <span id="baseCalloutBody">Remote base is using plain HTTP. Switch to HTTPS or a trusted tunnel before sharing admin surfaces.</span>
        </span>
        <button id="btn-base-callout" class="ghost mini" type="button" aria-label="Open network hardening guide">Network guide</button>
      </div>
      <p class="training-intro">Tune presets, monitor cascade telemetry, and act on job-level suggestions without leaving your project.</p>
      <section class="card training-guide" aria-labelledby="trainingGuideTitle">
        <div class="training-guide-head">
          <h2 id="trainingGuideTitle">Quick start</h2>
          <p class="dim">Run a safe dry-run before promoting changes to live cascades.</p>
        </div>
        <ol>
          <li><strong>Select a preset.</strong> Start with <em>balanced</em> or <em>performance</em> to inherit guardrails.</li>
          <li><strong>Adjust sliders with intent.</strong> Keep changes within ±0.1 unless you have new telemetry to justify more.</li>
          <li><strong>Run an A/B dry run.</strong> Use “Run A/B” to schedule a comparison before applying suggestions.</li>
        </ol>
        <div class="training-guide-actions row">
          <button id="trainingGuideDocs" class="ghost" type="button">Open training guide</button>
          <button id="trainingGuideDismiss" class="ghost" type="button">Hide tips</button>
          <span class="dim">Shift+A applies a suggestion • Shift+D dry-runs the focused job</span>
        </div>
      </section>
      <div class="layout">
        <main class="training-grid" role="region" aria-label="Training panels">
          <section class="card" role="region" aria-labelledby="controlsTitle">
            <h3 id="controlsTitle">Controls</h3>
            <p class="section-lead">Start with a preset, then adjust the governor sliders before running new experiments.</p>
            <div class="row">
              <label for="presetSelect">Preset</label>
              <select id="presetSelect">
                <option value="performance">performance</option>
                <option value="balanced" selected>balanced</option>
                <option value="power-saver">power-saver</option>
              </select>
            </div>
            <div class="row">
              <label for="diversitySlider">Diversity</label>
              <input id="diversitySlider" type="range" min="0" max="1" step="0.05" value="0.50" aria-describedby="diversityValue" />
              <span id="diversityValue" class="mono">0.50</span>
            </div>
            <div class="row">
              <label for="recencySlider">Recency</label>
              <input id="recencySlider" type="range" min="0" max="1" step="0.05" value="0.50" aria-describedby="recencyValue" />
              <span id="recencyValue" class="mono">0.50</span>
            </div>
            <div class="row">
              <label for="compressionSlider">Compression</label>
              <input id="compressionSlider" type="range" min="0" max="1" step="0.1" value="0.50" aria-describedby="compressionValue" />
              <span id="compressionValue" class="mono">0.50</span>
            </div>
            <div class="metric-block" id="governorHistoryBlock">
              <h4>Recent governor profiles</h4>
              <ul id="governorHistoryList" class="metric-list"></ul>
              <div class="row">
                <button id="clearGovernorHistory" class="ghost" type="button">Clear history</button>
              </div>
            </div>
          </section>
          <section class="card" role="region" aria-labelledby="contextTitle">
            <div class="row row-between">
              <h3 id="contextTitle">Context Telemetry</h3>
              <button id="refreshTelemetry" class="ghost" type="button">Refresh</button>
            </div>
            <p class="section-lead">Live signals from context assembly, governor health, and recall risk.</p>
            <p id="contextTelemetryStatus" class="dim mono" role="status" aria-live="polite">Loading…</p>
            <div id="contextTelemetryBody" hidden>
              <div class="metric-block" aria-live="polite">
                <h4>Coverage</h4>
                <span id="coverageNeedsMore" class="metric-pill">—</span>
                <p class="metric-inline"><span class="metric-label" id="coverageRatioLabel">Needs more ratio:</span><span id="coverageRatio">—</span></p>
                <div class="metric-meter">
                  <div id="coverageRatioBar" class="bar ratio-bar empty" role="meter" aria-labelledby="coverageRatioLabel" aria-describedby="coverageRatio" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0" aria-valuetext="No data">
                    <i></i>
                  </div>
                </div>
                <div>
                  <strong>Top reasons</strong>
                  <ul id="coverageReasons" class="metric-list"></ul>
                </div>
                <div>
                  <strong>Top slot gaps</strong>
                  <ul id="coverageTopSlots" class="metric-list"></ul>
                </div>
              </div>
              <div class="metric-block" aria-live="polite">
                <h4>Recall risk</h4>
                <p class="metric-inline"><span class="metric-label" id="recallAvgScoreLabel">Average risk score:</span><span id="recallAvgScore">—</span></p>
                <div class="metric-meter">
                  <div id="recallAvgScoreBar" class="bar ratio-bar empty" role="meter" aria-labelledby="recallAvgScoreLabel" aria-describedby="recallAvgScore" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0" aria-valuetext="No data">
                    <i></i>
                  </div>
                </div>
                <p class="metric-inline"><span class="metric-label" id="recallAtRiskLabel">At-risk ratio:</span><span id="recallAtRisk">—</span></p>
                <div class="metric-meter">
                  <div id="recallAtRiskBar" class="bar ratio-bar empty" role="meter" aria-labelledby="recallAtRiskLabel" aria-describedby="recallAtRisk" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0" aria-valuetext="No data">
                    <i></i>
                  </div>
                </div>
                <div>
                  <strong>Top slot gaps</strong>
                  <ul id="recallTopSlots" class="metric-list"></ul>
                </div>
              </div>
              <div class="metric-block" aria-live="polite">
                <h4>Latest assembly</h4>
                <p class="metric-inline mono" id="contextSummaryCounts">—</p>
                <p class="metric-inline" id="contextSpecSummary">—</p>
              </div>
              <div class="metric-block" aria-live="polite">
                <h4>Episode cascade</h4>
                <p id="cascadeStatus" class="metric-inline dim mono">Waiting for telemetry…</p>
                <ul id="cascadeSummaries" class="metric-list"></ul>
              </div>
              <div class="metric-block" aria-live="polite">
                <h4>Policy capsules</h4>
                <p class="metric-inline" id="capsuleAccessibleSummary">—</p>
                <p class="metric-inline"><span class="metric-label">Next expiry:</span><span id="capsuleNextExpiry">—</span></p>
                <div>
                  <strong>Status totals</strong>
                  <ul id="capsuleStatusCounts" class="metric-list"></ul>
                </div>
                <div>
                  <strong>Sample</strong>
                  <ul id="capsuleSample" class="metric-list"></ul>
                </div>
              </div>
            </div>
          </section>
          <section class="card" role="region" aria-labelledby="resultsTitle">
            <div class="row row-between">
              <h3 id="resultsTitle" title="↑/↓ to move • Enter to toggle details • Shift+A apply • Shift+D dry-run">Training jobs</h3>
              <button id="refreshJobs" class="ghost" type="button">Refresh</button>
            </div>
            <p class="section-lead">Track orchestrated jobs, apply recommended logic units, and export history for deeper analysis.</p>
            <div class="row">
              <label for="jobStatusFilter">Status</label>
              <select id="jobStatusFilter">
                <option value="all" selected>All</option>
                <option value="running">Running</option>
                <option value="completed">Completed</option>
                <option value="queued">Queued</option>
                <option value="failed">Failed</option>
              </select>
              <button id="resetDismissedJobs" class="ghost" type="button">Show hidden</button>
            </div>
            <p id="jobsStatus" class="dim mono">Loading…</p>
            <div id="results" class="mono"></div>
            <div id="logicUnitHistory" class="metric-block" aria-live="polite"></div>
            <div class="row row-tight">
              <button id="exportHistory" class="ghost" type="button">Download history (JSON)</button>
            </div>
          </section>
          <section class="card" role="region" aria-labelledby="shortcutsTitle">
            <h3 id="shortcutsTitle">Keyboard shortcuts</h3>
            <p class="section-lead">Navigate training jobs quickly without leaving the keyboard.</p>
            <ul class="metric-list">
              <li><strong>↑ / ↓</strong> — focus previous/next job</li>
              <li><strong>Enter</strong> — toggle job details</li>
              <li><strong>Shift + A</strong> — apply suggestion for focused job</li>
              <li><strong>Shift + D</strong> — dry-run suggestion for focused job</li>
            </ul>
          </section>
        </main>
        <aside id="sidecar"></aside>
      </div>
    </div>
  </body>
  </html>
