<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ARW Projects</title>
    <link rel="stylesheet" href="tokens.css" />
    <link rel="stylesheet" href="ui-kit.css" />
    <link rel="stylesheet" href="common.css" />
    <link rel="stylesheet" href="hub.css" />
    <script src="common.js" defer></script>
    <script type="module" src="sidecar.js"></script>
    <script src="hub.js" defer></script>
  </head>
  <body data-page="hub">
    <a href="#main" class="skip-link">Skip to main content</a>
    <div class="wrap">
      <header class="hub-toolbar">
        <div class="toolbar-primary">
          <div class="title-block">
            <strong>Projects</strong>
            <p>Stay in sync with files, context, and run artifacts for every project.</p>
          </div>
          <div class="connection-block">
            <label>Port: <input id="port" type="number" min="1" max="65535" value="8091"></label>
            <span id="baseBadge" class="badge base-badge mono" aria-live="polite"></span>
          </div>
        </div>
        <div class="toolbar-secondary">
          <details class="toolbar-group" data-role="layout">
            <summary>Customize layout</summary>
            <div class="toolbar-actions">
              <button id="btn-focus" class="ghost">Toggle Focus</button>
              <button id="btn-save" class="ghost">Save Layout</button>
              <button id="btn-apply" class="ghost">Apply Layout</button>
              <label class="key"><input type="checkbox" id="tplPerProj"> per-project</label>
            </div>
          </details>
          <details class="toolbar-group" data-role="shortcuts">
            <summary>Quick tools</summary>
            <div class="toolbar-actions">
              <button id="btn-gallery" class="ghost">Gallery</button>
              <button id="btn-shortcuts" class="ghost" title="Show keyboard shortcuts">Shortcuts</button>
              <button id="btn-help" class="ghost" title="Open keyboard shortcuts docs">Help</button>
            </div>
          </details>
        </div>
        <div class="toolbar-status">
          <span id="galleryBadge" class="badge" title="Recent screenshots"><span class="dot"></span> 0</span>
          <span id="runtimeBadge" class="badge" aria-live="polite" aria-atomic="true"></span>
          <span id="statusBadges" class="badges"></span>
          <span id="sseStat" class="dim" role="status" aria-live="polite">SSE: off</span>
        </div>
      </header>
      <p class="section-lead hub-intro">Pick or create a project to hydrate every panel. Files, notes, context, and diagnostics stay in step as you work.</p>
      <ul class="hub-quickstart">
        <li>Select a project in the Files panel to load its notes, runs, and context.</li>
        <li>Use Notes to capture decisions or next steps—autosave keeps updates in place.</li>
        <li>Refresh Runtimes or Context while you diagnose cascades or drift.</li>
        <li data-mode="expert-only">Need more signal? Keep the Events window open in Expert mode to pair live telemetry with these panels.</li>
      </ul>
      <div id="baseCallout" class="hero-callout" role="alert" hidden>
        <span class="hero-callout-icon" aria-hidden="true">!</span>
        <span>
          <strong>Secure remote access.</strong>
          <span id="baseCalloutBody">Remote base is using plain HTTP. Switch to HTTPS or a trusted tunnel before sharing admin surfaces.</span>
        </span>
        <button id="btn-base-callout" class="ghost mini" type="button" aria-label="Open network hardening guide">Network guide</button>
      </div>
      <section class="card hub-empty" id="hubOnboarding" hidden aria-live="polite">
        <div class="hub-empty-head">
          <h2>Bring a project online</h2>
          <p>Create a project to sync files, notes, context, and runs across every workspace without leaving your machine.</p>
        </div>
        <ol class="hub-empty-steps">
          <li>
            <strong>Create a project for this workspace.</strong>
            <span>Name the project in the Files panel to initialize a new local workspace.</span>
          </li>
          <li>
            <strong>Import the files you need.</strong>
            <span>Use the Import and Save to project actions to bring artifacts into the workspace.</span>
          </li>
          <li>
            <strong>Invite teammates when ready.</strong>
            <span>Federate trusted machines from the Connections manager to share load.</span>
          </li>
        </ol>
        <div class="hub-empty-actions row">
          <button id="btnOnboardCreate" class="primary" type="button">Create project</button>
          <button id="btnOnboardDocs" class="ghost" type="button">Project Hub guide</button>
        </div>
      </section>
      <div class="layout" id="hubLayout">
        <main class="grid cols-2" id="main">
          <section class="card" id="files" role="region" aria-labelledby="filesTitle">
            <h3 id="filesTitle">Files</h3>
            <p class="section-lead">Browse the project tree, preview files, and copy paths in a click.</p>
            <div class="row">
              <label class="key">Project</label>
              <select id="projSel" aria-label="Select project" style="min-width:180px"></select>
              <input id="projName" aria-label="New project name" placeholder="new project" style="min-width:180px">
              <button id="btnCreateProj" class="ghost">Create</button>
              <button id="btnRefreshProj" class="ghost">Refresh</button>
              <button id="btnProjPrefs" class="ghost">Prefs</button>
              <span id="projPrefsBadge" class="badge" title="Project overrides" style="display:none"><span class="dot"></span> Editor</span>
              <span class="dim" id="projStat"></span>
            </div>
            <div class="row">
              <button id="btnTreeBack" class="ghost" aria-label="Back to previous folder">Back</button>
              <input id="fileFilter" placeholder="filter files…" aria-label="Filter files" style="min-width:200px">
              <div id="crumbs" class="row" style="flex-wrap:wrap"></div>
            </div>
            <div id="projTree" class="card" role="tree" aria-label="Project files" aria-multiselectable="false" style="background:#fff; max-height:260px; overflow:auto"></div>
            <div id="treeMeta" class="tree-meta" role="status" aria-live="polite" style="display:none"></div>
            <div class="dim" style="margin-top:6px">Hint: Click folders to navigate; click files to preview or copy.</div>
          </section>
          <section class="card" id="notes" role="region" aria-labelledby="notesTitle">
            <h3 id="notesTitle">Notes</h3>
            <p class="section-lead">Keep lightweight context or next actions alongside the project.</p>
            <div class="row"><span class="key">project</span> <code id="curProj">–</code></div>
            <textarea id="notesArea" style="width:100%; min-height:160px" placeholder="Project notes..."></textarea>
            <div id="notesMeta" class="notes-meta" role="status" aria-live="polite" style="display:none"></div>
            <div class="row"><button id="btnSaveNotes" class="primary">Save Notes</button> <button id="btnReloadNotes" class="ghost">Reload</button> <label class="key"><input type="checkbox" id="notesAutosave" checked aria-label="Enable notes autosave"> autosave</label> <span id="notesStat" role="status" aria-live="polite" class="dim"></span></div>
          </section>
          <section class="card" id="agents" role="region" aria-labelledby="agentsTitle">
            <h3 id="agentsTitle">Agents</h3>
            <p class="section-lead">Inspect orchestrator roles and switch scopes to debug distributed runs.</p>
            <div class="row">
              <label class="key">role</label>
              <select id="roleSel">
                <option>root</option>
                <option>regional</option>
                <option selected>edge</option>
                <option>connector</option>
                <option>observer</option>
              </select>
              <button id="btnRoleApply" class="ghost">Apply</button>
              <button id="btnRoleRefresh" class="ghost">Refresh</button>
            </div>
            <pre id="agentState" class="mono" style="max-height:200px; overflow:auto">{}</pre>
          </section>
          <section class="card" id="runtime" role="region" aria-labelledby="runtimeTitle">
            <h3 id="runtimeTitle">Runtimes <span class="dim" style="font-weight:400">(Managed)</span></h3>
            <p class="section-lead">Monitor managed runtimes, restart budgets, and accelerator coverage.</p>
            <div class="row" role="toolbar" aria-label="Runtime controls">
              <button id="runtimeRefresh" class="ghost">Refresh</button>
              <label class="key"><input type="checkbox" id="runtimeAuto" checked> auto refresh</label>
              <button id="runtimeCopyAll" class="ghost">Copy snapshot</button>
              <button id="runtimeFocusTable" class="ghost btn-small" type="button">Focus table</button>
              <button id="runtimeWizardBtn" class="ghost btn-small" type="button" data-mode="guided-only" title="Guided setup for managed runtimes">Runtime wizard</button>
              <a href="https://github.com/t3hw00t/ARW/blob/main/docs/guide/runtime_matrix.md" target="_blank" rel="noopener noreferrer" class="ghost" role="button">Runbook</a>
              <span id="runtimeStat" class="dim" role="status" aria-live="polite" style="margin-left:auto"></span>
            </div>
            <details id="runtimeRunbook" class="runtime-runbook" data-mode="expert-only">
              <summary>Operator guidance</summary>
              <p>
                Restart requests instruct the managed runtime supervisor to rebuild or restart the selected
                backend. Each restart consumes from the configured budget window. Confirm the runtime is idle and
                the adapter is ready before requesting a restore. See the full runbook for escalation steps and
                presets.
              </p>
            </details>
            <div id="runtimeHints" class="runtime-hints" role="region" aria-live="polite" aria-labelledby="runtimeHintsTitle" hidden>
              <h4 id="runtimeHintsTitle">Operator cues</h4>
              <p id="runtimeConsentHint" class="dim" role="status" aria-live="polite"></p>
              <p id="runtimeHardwareHint" class="dim" role="status" aria-live="polite"></p>
              <div class="runtime-hints-actions" role="toolbar" aria-label="Runtime reference links">
                <a class="ghost mini" href="https://github.com/t3hw00t/ARW/blob/main/docs/architecture/capability_consent_ledger.md" target="_blank" rel="noopener noreferrer">Consent guide</a>
                <a class="ghost mini" href="https://github.com/t3hw00t/ARW/blob/main/docs/guide/runtime_matrix.md" target="_blank" rel="noopener noreferrer">Hardware checklist</a>
              </div>
            </div>
            <div style="overflow:auto; max-height:220px">
              <table aria-label="Managed runtimes" data-runtime-table tabindex="-1">
                <thead>
                  <tr><th scope="col">Runtime</th><th scope="col">Status</th><th scope="col">Profile</th><th scope="col">Budget</th><th scope="col">Updated</th><th scope="col">Actions</th></tr>
                </thead>
                <tbody id="runtimeTbl"></tbody>
              </table>
            </div>
            <div id="runtimeAnnounce" class="sr-only" aria-live="assertive"></div>
            <div id="runtimeEmpty" class="dim" role="status" aria-live="polite">No managed runtimes registered.</div>
            <div class="runtime-matrix" role="region" aria-live="polite" aria-labelledby="runtimeMatrixTitle" data-mode="expert-only">
              <h4 id="runtimeMatrixTitle">Node Status</h4>
              <div id="runtimeMatrix"></div>
            </div>
            <div class="runtime-bundles" role="region" aria-live="polite" aria-labelledby="runtimeBundlesTitle">
              <h4 id="runtimeBundlesTitle">Installed Bundles</h4>
              <div id="runtimeBundles"></div>
            </div>
          </section>
          <section class="card" id="context" role="region" aria-labelledby="contextTitle">
            <h3 id="contextTitle">What's in Context Now</h3>
            <p class="section-lead">Understand the assembled prompt context, cascade summaries, and recall risk.</p>
            <p class="metric-help">Run a cascade or orchestrated episode to refresh these signals. Coverage nudges help spot gaps before recall risk climbs.</p>
            <div class="row">
              <button id="btnContextRefresh" class="ghost">Refresh</button>
              <label class="key"><input id="contextIncludeSources" type="checkbox"> include seeds</label>
              <span class="dim" id="contextStat" role="status" aria-live="polite"></span>
            </div>
            <div id="contextPreview" class="context-preview" role="status" aria-live="polite">Context preview will appear here after the next assembly.</div>
            <div id="contextSummary" class="context-summary">Items 0 · Seeds 0 · Expanded 0</div>
            <div id="contextMeta" class="context-meta">No context specification recorded yet.</div>
            <div id="contextMetrics" class="context-metrics" data-mode="expert-only">
              <div class="metric-block" aria-live="polite">
                <h4>Coverage</h4>
                <p class="metric-help">Tracks how many required slots still need grounding before the next run.</p>
                <p class="metric-inline"><span class="metric-label">Status:</span><span id="contextCoverageStatus" class="metric-pill">Awaiting data</span></p>
                <p class="metric-inline"><span class="metric-label">Needs more:</span><span id="contextCoverageRatio">—</span></p>
                <div id="contextCoverageRatioBar" class="bar ratio-bar empty metric-meter" role="meter" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0" aria-valuetext="No data"><i></i></div>
                <ul id="contextCoverageReasons" class="metric-list"></ul>
              </div>
              <div class="metric-block" aria-live="polite">
                <h4>Recall Risk</h4>
                <p class="metric-help">Blend of recency and diversity drift. Investigate any spikes before approving memory writes.</p>
                <p class="metric-inline"><span class="metric-label">Avg score:</span><span id="contextRecallAvg">—</span></p>
                <div id="contextRecallAvgBar" class="bar ratio-bar empty metric-meter" role="meter" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0" aria-valuetext="No data"><i></i></div>
                <p class="metric-inline"><span class="metric-label">At risk:</span><span id="contextRecallAtRisk">—</span></p>
                <div id="contextRecallAtRiskBar" class="bar ratio-bar empty metric-meter" role="meter" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0" aria-valuetext="No data"><i></i></div>
                <ul id="contextRecallTop" class="metric-list"></ul>
              </div>
            </div>
            <span id="contextMetricsUpdated" class="dim" role="status" aria-live="polite"></span>
            <div id="contextItems" class="context-items" role="list" aria-label="Assembled context items">
              <div class="context-empty">No context assembled yet.</div>
            </div>
            <h4 id="contextCascadeTitle" style="margin-top:12px">Episode summaries</h4>
            <div id="contextCascade" class="context-items" role="list" aria-labelledby="contextCascadeTitle">
              <div class="context-empty">Select a project to view cascade summaries.</div>
            </div>
            <div id="contextRehydrateWrap" class="context-restore">
              <div class="row">
                <strong>Last Rehydrate</strong>
                <button id="btnContextCopy" class="ghost" disabled>Copy result</button>
                <span class="dim" id="contextRehydrateMeta"></span>
              </div>
              <pre id="contextRehydrateOut" class="cmp-code" aria-live="polite"></pre>
            </div>
          </section>
          <section class="card" id="runs" role="region" aria-labelledby="runsTitle">
            <h3 id="runsTitle">Runs</h3>
            <p class="section-lead">Filter recent orchestrations, compare snapshots, and inspect artifacts.</p>
            <div class="row">
              <input id="runFilter" placeholder="filter runs…" aria-label="Filter runs by id, actor, kind, or project" style="min-width:200px">
              <label class="key">Actor
                <select id="runActorFilter" aria-label="Filter runs by actor">
                  <option value="">all actors</option>
                </select>
              </label>
              <label class="key">Kind
                <select id="runKindFilter" aria-label="Filter runs by event kind">
                  <option value="">all kinds</option>
                </select>
              </label>
              <label class="key"><input id="runErrOnly" type="checkbox"> errors only</label>
              <button id="btnRunsRefresh" class="ghost">Refresh</button>
              <span class="dim" id="runsStat"></span>
            </div>
            <div style="overflow:auto; max-height:220px">
              <table aria-label="Recent episodes">
                <thead><tr><th>id</th><th>count</th><th>ms</th><th>errors</th><th>info</th><th>actions</th></tr></thead>
                <tbody id="runsTbl"></tbody>
              </table>
            </div>
            <div class="row" style="margin-top:6px">
              <button id="btnRunCopy" class="ghost">Copy snapshot</button>
              <button id="btnRunPinA" class="ghost">Pin A</button>
              <button id="btnRunPinB" class="ghost">Pin B</button>
              <span class="dim" id="runSnapMeta"></span>
            </div>
            <pre id="runSnap" class="cmp-code" style="max-height:200px"></pre>
            <div class="row" style="margin-top:6px"><strong>Artifacts</strong> <span class="dim">(outputs and payloads)</span></div>
            <div style="overflow:auto; max-height:200px">
              <table aria-label="Run artifacts">
                <thead><tr><th>kind</th><th>summary</th><th>pin</th></tr></thead>
                <tbody id="artifactsTbl"></tbody>
              </table>
            </div>
          </section>
          <section class="card" id="compare" role="region" aria-labelledby="compareTitle">
            <h3 id="compareTitle">Compare</h3>
            <p class="section-lead">Pin two outputs and diff them across text, images, or tabular data.</p>
            <div class="cmp-tabs" role="tablist" aria-label="Compare views">
              <button id="tab-text" role="tab" class="active" aria-selected="true" aria-controls="cmpText" tabindex="0" title="Show Text / JSON compare">Text / JSON</button>
              <button id="tab-image" role="tab" aria-selected="false" aria-controls="cmpImage" tabindex="-1" title="Show Image compare">Image</button>
              <button id="tab-csv" role="tab" aria-selected="false" aria-controls="cmpCSV" tabindex="-1" title="Show Table compare">CSV / Table</button>
            </div>
            <div id="cmpText" role="tabpanel" aria-labelledby="tab-text">
              <div class="row">
                <textarea id="cmpA" placeholder="Paste text/JSON A" style="flex:1;min-height:120px"></textarea>
                <textarea id="cmpB" placeholder="Paste text/JSON B" style="flex:1;min-height:120px"></textarea>
              </div>
              <div class="controls">
                <label class="key"><input type="checkbox" id="txtOnlyChanges"/> only changes</label>
                <label class="key"><input type="checkbox" id="txtWrap" checked/> wrap</label>
                <span class="spacer"></span>
                <button id="btn-diff" class="primary">Diff</button>
                <button id="btn-copy-diff" class="ghost">Copy diff</button>
                <span class="dim">Drop files into either box</span>
              </div>
              <div id="cmpOut" class="cmp-code"></div>
            </div>
            <div id="cmpImage" role="tabpanel" aria-labelledby="tab-image" hidden style="display:none">
              <div class="row"><input id="imgA" type="file" accept="image/*"> <input id="imgB" type="file" accept="image/*"></div>
              <div class="img-compare" id="imgCmp">
                <img id="imgUnder" alt="B"/>
                <img id="imgOver" class="top" alt="A"/>
                <input id="imgSlider" type="range" min="0" max="100" value="50"/>
              </div>
            </div>
            <div id="cmpCSV" role="tabpanel" aria-labelledby="tab-csv" hidden style="display:none">
              <div class="row">
                <textarea id="csvA" placeholder="Paste CSV/TSV A" style="flex:1;min-height:120px"></textarea>
                <textarea id="csvB" placeholder="Paste CSV/TSV B" style="flex:1;min-height:120px"></textarea>
              </div>
              <div class="controls">
                <input id="csvKey" placeholder="Key column(s), comma-separated" style="flex:1;min-width:200px"/>
                <label class="key"><input id="csvHeader" type="checkbox" checked/> header row</label>
                <label class="key"><input id="csvOnlyChanges" type="checkbox"/> only changes</label>
                <label class="key"><input id="csvTwoRow" type="checkbox"/> two‑row changes</label>
                <span class="spacer"></span>
                <button id="btn-csv-diff" class="primary">Diff Tables</button>
                <button id="btn-csv-export" class="ghost">Export CSV</button>
                <button id="btn-csv-copy" class="ghost">Copy summary</button>
              </div>
              <div id="csvSummary" class="cmp-summary"></div>
              <div id="csvOut" class="cmp-code" style="padding:0"></div>
            </div>
          </section>
        </main>
        <aside id="sidecar"></aside>
      </div>
    </div>
  </body>
  </html>
